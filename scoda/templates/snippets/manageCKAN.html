<script type="text/javascript">

    var csrf_token = "{{ csrf_token() }}";

    $.ajaxSetup({
        beforeSend: function(xhr, settings) {
            if (!/^(GET|HEAD|OPTIONS|TRACE)$/i.test(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrf_token);
            }
        }
    });

    $(document).ready(function () {
        $('.js-example-basic-single').select2();
        $('.js-example-basic-multiple').select2();

        $('#newButton').click(function(){$('input[id=new_submitted]').val('1');});
        $('#editButton').click(function(){$('input[id=edit_submitted]').val('1');});
        $('#deleteButton').click(function(){$('input[id=delete_submitted]').val('1');});

        {% if tour %}

            var tour = new Shepherd.Tour({
                defaults: {
                    classes: 'shepherd-theme-dark',
                    scrollTo: true
                }
            });

            tour.addStep('welcome', {
                title: 'Welcome to the Demographics Explorer!',
                text: 'This short tour will guide you through the necessary steps to explore the demographic modelling data contained in this almanac. You can exit the tour at any stage by clicking on the "Exit" button.',
                attachTo: '#formCardHead right',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.addStep('form', {
                title: 'The Selection Form',
                text: 'This form is here to help you find the region you are interested in exploring. The selection fields will allow you to find the city, ward and year that you would like to explore. ',
                attachTo: '#formCard right',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Back',
                        action: tour.back
                    },
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.addStep('city', {
                title: 'City Selector',
                text: 'This field allows you to select the the city you would like to look at.',
                attachTo: '#city_label right',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Back',
                        action: tour.back
                    },
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.addStep('ward', {
                title: 'Ward Selector',
                text: 'This field allows you to select the ward that you would like to look at. Initially, and when "View All" is selected, the aggregated ward data will be shown. Selecting a particular ward and clicking "Submit" will zoom to that Ward and will show the small enumerator areas along with their data values.',
                attachTo: '#ward_label right',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Back',
                        action: tour.back
                    },
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.addStep('year', {
                title: 'Year Selector',
                text: 'This field allows you to choose which year\'s data values you would like to explore.',
                attachTo: '#year_label right',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Back',
                        action: tour.back
                    },
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.addStep('submit', {
                title: 'Submit Button',
                text: 'Once you have made your selections, click "Submit" to view the data!',
                attachTo: '#submitButton right',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Back',
                        action: tour.back
                    },
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.addStep('plot', {
                title: 'Map Area',
                text: 'This map shows projected migration values at the ward and small enumerator area levels for each metro. Clicking on an area will zoom to it, though clicking on a ward will NOT reveal its underlying enumerators.',
                attachTo: '#geoCard left',
                advanceOn: '.docs-link click',
                buttons: [
                    {
                        text: 'Back',
                        action: tour.back
                    },
                    {
                        text: 'Exit',
                        action: tour.complete
                    },
                    {
                        text: 'Next',
                        action: tour.next
                    }
                ]
            });

            tour.start();

        {% endif %}
    });

</script>

<div class="container-fluid">
    <div id="ui-view" style="opacity: 1;">
        <div class="animated fadeIn">
            <div class="row">

            {% if is_submitted %}

                <div class="col-sm-3 col-lg-3 col-lg-3">
                    <div class="card" id="selectorCard">
                        <div class="card-header" id="formCardHead">Upload a New Dataset
                        </div>
                         <div class="card-block collapse in " id="newFormCard" aria-expanded="true">
                            <p>Submission successful!</p>
                            <br>
                            <a href="{{ url_for('my_datasets') }}"><button class="btn btn-success">Back to My Datasets</button></a>
                         </div>
                    </div>
                </div>

            {% else %}

                <div class="col-sm-4 col-lg-4 col-lg-4">
                    <div class="card" id="selectorCard">
                        <div class="card-header" id="formCardHead">Upload a New Dataset
                            <div class="card-actions">
                                <a class="btn-minimize" data-toggle="collapse" href="#newFormCard" aria-expanded="true"
                                   aria-controls="newFormCard"><i class="icon-arrow-down"></i></a>
                            </div>
                        </div>
                        <div class="card-block collapse" id="newFormCard" aria-expanded="true">
                            <form action="{{ url_for('my_datasets') }}" enctype=multipart/form-data id="newForm" class="form-horizontal" method="POST">
                                {{ new_form.csrf_token }}
                                {{ new_form.hidden_tag() }}


                                <div class="form-group{% if new_form.ds_name.errors %} has-error {% endif %}">
                                    <div class="control-label" id="new_dataset_label">
                                        Dataset name:
                                    </div>
                                    <div>
                                        {{ new_form.ds_name(id='new_ds_name',placeholder="Type your name (optional)...", styl="width: 100%", class="form-control") }}
                                    </div>
                                    <p class="help-block">
                                        {{ new_form.ds_name.errors[0] }}
                                </div>

                                <div class="form-group {% if new_form.fileName.errors %} has-error {% endif %}">
                                    <div class="control-label" id="new_filename_label">
                                        Upload file:
                                    </div>
                                    <div>
                                        {{ new_form.fileName(id='new_fileName',style="width: 100%") }}
                                    </div>
                                    <p class="help-block">
                                        {{ new_form.fileName.errors[0] }}
                                </div>

                                <button class="btn btn-success" id="newButton" type="submit">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-sm-4 col-lg-4 col-lg-4">
                    <div class="card" id="selectorCard">
                        <div class="card-header" id="formCardHead">Update an Existing Dataset
                            <div class="card-actions">
                                <a class="btn-minimize" data-toggle="collapse" href="#editFormCard" aria-expanded="true"
                                   aria-controls="editFormCard"><i class="icon-arrow-down"></i></a>
                            </div>
                        </div>
                        <div class="card-block collapse" id="editFormCard" aria-expanded="true">
                            <form action="{{ url_for('my_datasets') }}" enctype=multipart/form-data id="editForm" class="form-horizontal" method="POST">
                                {{ edit_form.csrf_token }}
                                {{ edit_form.hidden_tag() }}
                                {{ edit_form.file }}

                                <div class="form-group {% if edit_form.ds_id.errors %} has-error {% endif %}">
                                    <div class="control-label" id="edit_dataset_label">
                                        Dataset name:
                                    </div>
                                    <div>
                                        {{ edit_form.ds_id(id='edit_ds_id',class="js-example-basic-single", style="width: 100%") }}
                                    </div>
                                    <p class="help-block">
                                        {{ edit_form.ds_id.errors[0] }}
                                </div>

                                <div class="form-group {% if edit_form.fileName.errors %} has-error {% endif %}">
                                    <div class="control-label" id="edit_filename_label">
                                        Upload file:
                                    </div>
                                    <div>
                                        {{ edit_form.fileName(id='edit_fileName',style="width: 100%") }}
                                    </div>
                                    <p class="help-block">
                                        {{ edit_form.fileName.errors[0] }}
                                </div>

                                <button class="btn btn-success" id="editButton" type="submit">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-sm-4 col-lg-4 col-lg-4">
                    <div class="card" id="selectorCard">
                        <div class="card-header" id="formCardHead">Delete an Existing Dataset
                            <div class="card-actions">
                                <a class="btn-minimize" data-toggle="collapse" href="#deleteFormCard" aria-expanded="true"
                                   aria-controls="deleteFormCard"><i class="icon-arrow-down"></i></a>
                            </div>
                        </div>
                        <div class="card-block collapse" id="deleteFormCard" aria-expanded="true">
                            <form action="{{ url_for('my_datasets') }}" enctype=multipart/form-data id="deleteForm" class="form-horizontal" method="POST">
                                {{ delete_form.csrf_token }}
                                {{ delete_form.hidden_tag() }}
                                {{ delete_form.file }}

                                <div class="form-group {% if delete_form.ds_id.errors %} has-error {% endif %}">
                                    <div class="control-label" id="delete_dataset_label">
                                        Dataset name:
                                    </div>
                                    <div>
                                        {{ delete_form.ds_id(id='delete_ds_id',class="js-example-basic-single", style="width: 100%") }}
                                    </div>
                                    <p class="help-block">
                                        {{ delete_form.ds_id.errors[0] }}
                                </div>

                                <button class="btn btn-success" id="deleteButton" type="submit">Submit</button>
                            </form>
                        </div>
                    </div>
                </div>

            {% endif %}
            </div>
        </div>
    </div>
</div>